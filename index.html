<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f1a" />
  <link rel="icon" href="logo.png" />
  <title>CYBER DRAGON ‚Äî Home</title>
  <style>
    :root{
      --bg:#0b0f1a; --text:#fff; --muted:#9fb3c8;
      --glass:rgba(255,255,255,.06); --glass-2:rgba(16,22,36,.72);
      --line:rgba(255,255,255,.12);
      --brandA:#4fd3ff; --brandB:#8f00ff; --accent:#ffcc33;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    html{-webkit-text-size-adjust:100%}
    body{
      margin:0;color:var(--text);
      font:16px/1.48 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
      background:url('fon.png') center/cover fixed no-repeat, var(--bg);
      -webkit-font-smoothing:antialiased; -webkit-tap-highlight-color:transparent;
    }
    body::after{content:"";position:fixed;inset:0;pointer-events:none;z-index:-1;
      background:
        radial-gradient(1100px 900px at 10% -10%, #4168ff22, transparent 60%),
        radial-gradient(1100px 900px at 90% 110%, #b34dff22, transparent 55%);
    }
    .app{
      max-width:430px;margin:0 auto;min-height:100dvh;
      padding:calc(14px + env(safe-area-inset-top)) 14px calc(28px + env(safe-area-inset-bottom));
      overscroll-behavior-y: contain;
    }

    /* Header */
    .header{position:sticky; top:0; z-index:30; margin:-6px -4px 10px}
    .bar{
      display:flex; align-items:center; gap:10px; padding:8px;
      backdrop-filter:saturate(140%) blur(12px);
      background:linear-gradient(to bottom, rgba(10,15,26,.8), rgba(10,15,26,.45));
      border:1px solid var(--line); border-radius:16px;
    }
    .brand{margin:0;font-size:1.06rem;letter-spacing:.35px;font-weight:900;display:flex;align-items:center;gap:6px}
    .brand .mark{height:18px;width:auto;vertical-align:middle;filter:drop-shadow(0 0 8px #9b5bff99)}
    .lang{margin-left:auto}
    .lang select{
      appearance:none;border-radius:10px;padding:10px 28px 10px 12px;min-height:44px;
      color:var(--text);background:var(--glass-2);border:1px solid var(--line);outline:none
    }
    .burger{
      width:44px;height:44px;border-radius:12px;border:1px solid var(--line);
      background:var(--glass-2);color:#fff;display:grid;place-items:center;cursor:pointer
    }
    .burger:active{transform:scale(.98)}
    .nav-pop{
      position:absolute;right:14px;top:64px;background:rgba(10,14,24,.95);backdrop-filter:blur(14px) saturate(140%);
      border:1px solid var(--line);border-radius:14px;padding:8px;display:none;min-width:220px;z-index:40
    }
    .nav-pop.open{display:block}
    .nav-pop a,.nav-pop .lang-inline{
      display:flex;align-items:center;gap:10px;padding:12px;border-radius:10px;color:#fff;text-decoration:none;min-height:44px
    }
    .nav-pop a:hover,.nav-pop .lang-inline:hover{background:var(--glass)}
    .nav-pop hr{border:0;height:1px;background:var(--line);margin:6px 0}
    .nav-pop .lang-inline select{flex:1;background:var(--glass-2);border:1px solid var(--line);color:#fff;border-radius:10px;padding:8px 10px;min-height:44px}

    /* Hero */
    .hero{
      position:relative; overflow:hidden; border-radius:18px; height:62vh; min-height:440px;
      border:1px solid var(--line); box-shadow:0 18px 28px #001a2f66;
      background:linear-gradient(135deg,#183a63,#522a8a); margin-top:10px;
    }
    .hero video{position:absolute; inset:0; width:100%; height:100%; object-fit:cover; filter:brightness(.78) contrast(1.05)}
    .hero .veil{position:absolute; inset:0; background:radial-gradient(60% 60% at 50% 45%, rgba(0,0,0,.25), rgba(0,0,0,.58))}
    .hero .center{position:absolute; inset:0; display:grid; place-items:center; text-align:center; gap:14px; padding:22px}
    .logoBig{width:210px; max-width:65%; filter:drop-shadow(0 0 14px #b44cffaa)}
    .btn{
      border:none; border-radius:999px; padding:14px 22px; font-weight:900; cursor:pointer; min-height:52px;
      color:#001027; background:linear-gradient(90deg,var(--brandA),var(--brandB)); text-decoration:none
    }
    .apps{position:absolute; left:0; right:0; bottom:14px; display:flex; gap:10px; justify-content:center; padding:0 10px}
    .app-badge{
      display:flex; align-items:center; gap:8px; padding:8px 12px; min-width:86px;
      background:rgba(0,0,0,.45); border:1px solid var(--line); color:#fff; border-radius:12px; text-decoration:none;
      backdrop-filter:blur(8px); font-weight:700; font-size:.92rem;
    }
    .app-badge svg{width:18px;height:18px}

    /* Tabs */
    .tabs{position:sticky;top:10px;margin-top:10px;border:1px solid var(--line);border-radius:14px;background:rgba(255,255,255,.05);backdrop-filter:blur(8px)}
    .tabs-inner{display:flex;gap:18px;overflow:auto;padding:10px 12px}
    .tab{white-space:nowrap;opacity:.85;cursor:pointer;font-weight:800}
    .tab.active{opacity:1;position:relative}
    .tab.active::after{content:"";position:absolute;left:0;right:0;bottom:-6px;height:3px;border-radius:3px;background:var(--accent)}

    /* Sections/cards */
    .section{background:var(--glass);border:1px solid var(--line);border-radius:18px;padding:14px;backdrop-filter:blur(10px);margin-top:10px}
    .muted{color:var(--muted)}
    .cta-row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .ghost{background:transparent;color:#fff;border:1px dashed var(--line)}
    .gallery{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
    .ph{aspect-ratio:1/1;border-radius:14px;border:1px solid var(--line);overflow:hidden;background:linear-gradient(135deg,#334b7a,#6842a6)}
    .gallery img{width:100%;height:100%;object-fit:cover;display:block}

    /* –ö–æ–Ω—Ç–µ–Ω—Ç: –∑–∞–≥–æ–ª–æ–≤–æ–∫ + –∫–Ω–æ–ø–∫–∞ –≤–∏–¥–∞ */
    .head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:6px}
    .view-toggle{
      width:40px;height:40px;border-radius:12px;border:1px solid var(--line);
      background:var(--glass-2);color:#fff;display:grid;place-items:center;cursor:pointer
    }
    .view-toggle:active{transform:scale(.98)}
    .view-toggle svg{width:22px;height:22px;display:none}
    .view-toggle[data-view="grid"] .ico-list{display:block}
    .view-toggle[data-view="list"] .ico-grid{display:block}

    /* –°–µ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ + —Ä–µ–∂–∏–º —Å–ø–∏—Å–∫–∞ */
    .list{display:grid;gap:10px;margin-top:8px;grid-template-columns:repeat(2,minmax(0,1fr))}
    .card{display:grid;grid-template-rows:auto auto auto;gap:8px;
      padding:10px;border-radius:18px;background:var(--glass);border:1px solid var(--line);backdrop-filter:blur(10px);position:relative;overflow:hidden}
    .thumb-wrap{position:relative}
    .thumb{width:100%;aspect-ratio:1/1;border-radius:20px;overflow:hidden;background:linear-gradient(135deg,#3a517f,#7a45cc)}
    .thumb img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block;border-radius:inherit}
    @supports (clip-path: inset(0 round 20px)){ .thumb{clip-path: inset(0 round 20px);} }
    .info{position:absolute;right:8px;top:8px;width:28px;height:28px;border-radius:999px;border:1px solid var(--line);
      background:var(--glass-2);color:#fff;cursor:pointer;display:grid;place-items:center;font-weight:800}
    .name{font-weight:800;line-height:1.2;min-height:2.4em}
    .foot{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .price{font-weight:800}
    .add{border:none;border-radius:999px;padding:10px 14px;background:linear-gradient(90deg,var(--brandA),var(--brandB));
      color:#001027;font-weight:800;cursor:pointer;min-height:40px;flex:1}

    /* –°–ø–∏—Å–æ–∫ */
    .list.as-list{grid-template-columns:1fr}
    .list.as-list .card{grid-template-columns:92px 1fr auto;grid-template-rows:auto auto;gap:10px}
    .list.as-list .thumb{width:92px;height:92px;aspect-ratio:auto;border-radius:14px}
    .list.as-list .thumb-wrap{grid-row:1/3}
    .list.as-list .name{grid-column:2}
    .list.as-list .foot{grid-column:2/4;justify-content:space-between}

    .qty{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);border-radius:999px;padding:6px 8px}
    .qty button{width:32px;height:32px;border:none;border-radius:10px;background:var(--glass-2);color:#fff;cursor:pointer}

    .map{border:1px solid var(--line);border-radius:14px;overflow:hidden;height:260px}
    iframe{width:100%;height:100%;border:0}

    .fab{position:sticky;bottom:calc(14px + env(safe-area-inset-bottom));display:flex;justify-content:center;margin-top:14px;z-index:35}
    .cart-fab{
      display:inline-flex;align-items:center;gap:10px;border:none;border-radius:999px;padding:12px 18px;cursor:pointer;color:#001027;
      background:linear-gradient(90deg,var(--brandA),var(--brandB));font-weight:800;box-shadow:0 18px 28px #001a2f66;min-height:48px
    }

    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);opacity:0;pointer-events:none;transition:.2s opacity;z-index:40}
    .overlay.show{opacity:1;pointer-events:auto}
    .sheet{
      position:fixed;left:0;right:0;bottom:0;width:100%;max-width:430px;margin:0 auto;
      background:rgba(10,14,24,.96);backdrop-filter:blur(16px) saturate(140%);
      border-top-left-radius:18px;border-top-right-radius:18px;border:1px solid var(--line);
      padding:14px;padding-bottom:calc(14px + env(safe-area-inset-bottom));
      transition:.25s transform; transform:translateY(100%);
      z-index:41; max-height:85dvh; overflow:auto; overscroll-behavior: contain;
    }
    .sheet.open{ transform:translateY(0) }
    .sheet h3{margin:0 0 8px}
    .cart-lines{display:grid;gap:10px;max-height:38dvh;overflow:auto;padding-right:4px}
    .line{display:grid;grid-template-columns:1fr auto;align-items:center;gap:10px;padding:8px;border-radius:12px;border:1px dashed var(--line)}
    .group{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:10px 14px;border-radius:999px;background:var(--glass);border:1px solid var(--line);cursor:pointer;min-height:44px}
    .chip.active{background:linear-gradient(90deg,var(--brandA),var(--brandB));color:#001027;border:none;font-weight:800}
    .field{display:grid;gap:6px;margin-top:8px}
    .field input,.field textarea{border-radius:10px;padding:12px;background:var(--glass-2);color:#fff;border:1px solid var(--line);outline:none;font-size:1rem;min-height:44px}
    .field textarea{min-height:72px;resize:vertical}
    .checkout{display:grid;gap:8px;margin-top:10px}
    .btn.primary{background:linear-gradient(90deg,var(--brandA),var(--brandB));color:#001027}
    .btn.ghost{background:transparent;border:1px dashed var(--line);color:#fff}

    /* === Glassmorphism buttons ‚Äî override === */
    :root{ --glass-btn: rgba(255,255,255,.08); --glass-btn-2: rgba(255,255,255,.12); --ring: rgba(255,255,255,.20); }
    .btn,.add,.cart-fab,.app-badge,.chip,.pill,.qty button,.burger,.view-toggle{
      background:var(--glass-btn); color:var(--text); border:1px solid var(--line);
      border-radius:14px; box-shadow:inset 0 1px 0 #ffffff10,inset 0 -1px 0 #00000030,0 10px 24px #00000040;
      backdrop-filter:blur(12px) saturate(140%); -webkit-backdrop-filter:blur(12px) saturate(140%); text-decoration:none;
    }
    .btn,.add{min-height:44px;padding:12px 16px;font-weight:800;border-radius:999px}
    .cart-fab{min-height:48px;padding:12px 18px;border-radius:999px}
    .app-badge{min-height:40px;padding:8px 12px;border-radius:12px}
    .chip,.pill{min-height:40px;padding:10px 14px;border-radius:999px}
    .qty button{width:32px;height:32px;border-radius:10px}
    .burger{width:44px;height:44px;border-radius:12px}
    .btn:hover,.add:hover,.cart-fab:hover,.app-badge:hover,.chip:hover,.pill:hover,.qty button:hover,.burger:hover,.view-toggle:hover{
      background:var(--glass-btn-2); border-color:var(--ring);
      box-shadow:inset 0 1px 0 #ffffff18,inset 0 -1px 0 #00000040,0 12px 28px #00000055,0 0 0 1px var(--ring);
    }
    .btn:active,.add:active,.cart-fab:active,.app-badge:active,.chip:active,.pill:active,.qty button:active,.burger:active,.view-toggle:active{
      transform:translateY(1px) scale(.99); box-shadow:inset 0 2px 8px #00000060,0 6px 16px #00000055;
    }
    .btn.primary{background:var(--glass-btn); color:var(--text); border:1px solid var(--line)}
    .hero .btn{background:var(--glass-btn); color:var(--text); border:1px solid var(--line); box-shadow:0 14px 28px #00000055}

    /* Close button on the sheet */
    .sheet-close{
      position:absolute; right:12px; top:12px;
      width:36px; height:36px; border-radius:10px;
      border:1px solid var(--line); background:var(--glass-2);
      color:#fff; display:grid; place-items:center; cursor:pointer;
    }
    .sheet-close:active{ transform:scale(.98) }
  </style>
</head>
<body>
  <div class="app" id="top">
    <!-- HEADER -->
    <header class="header">
      <div class="bar">
        <h1 class="brand">
          CYBER <img class="mark" src="logo.png" alt="Logo"> DRAGON
        </h1>

        <div class="lang" title="Language">
          <select id="langSel" aria-label="Language">
            <option value="ru">RU</option><option value="en">EN</option>
            <option value="ua">UA</option><option value="vn">VN</option>
            <option value="pl">PL</option><option value="de">DE</option>
            <option value="zh">ZH</option>
          </select>
        </div>

        <button class="burger" id="burger" aria-haspopup="true" aria-expanded="false" aria-controls="navPop">‚ò∞</button>
        <nav class="nav-pop" id="navPop" role="menu" aria-label="Main menu">
          <a href="index.html" role="menuitem" id="navHome">üè† HOME</a>
          <a href="menu.html" role="menuitem" id="navMenu">üçú MENU</a>
          <a href="karaoke.html" role="menuitem" id="navKaraoke">üé§ KARAOKE</a>
          <a href="contact.html" role="menuitem" id="navContact">üìû KONTAKT</a>
          <hr>
          <div class="lang-inline" role="none">
            üåê <select id="langSelMenu" aria-label="Language (menu)">
              <option value="ru">RU</option><option value="en">EN</option>
              <option value="ua">UA</option><option value="vn">VN</option>
              <option value="pl">PL</option><option value="de">DE</option>
              <option value="zh">ZH</option>
            </select>
          </div>
        </nav>
      </div>
    </header>

    <!-- HERO -->
    <section class="hero" aria-label="hero">
      <video autoplay muted loop playsinline>
        <source src="hero.mp4" type="video/mp4">
      </video>
      <div class="veil"></div>
      <div class="center">
        <img class="logoBig" src="logo.png" alt="Cyber Dragon">
        <a class="btn" href="menu.html" id="btnMenu">üçú –ú–µ–Ω—é</a>
      </div>

      <div class="apps">
        <a class="app-badge" href="https://www.instagram.com/" target="_blank" rel="noopener" aria-label="Instagram">
          <svg viewBox="0 0 24 24" fill="none"><rect x="3" y="3" width="18" height="18" rx="5" stroke="white" stroke-width="1.6"/><circle cx="12" cy="12" r="4" stroke="white" stroke-width="1.6"/><circle cx="17.5" cy="6.5" r="1.2" fill="white"/></svg>
          IG
        </a>
        <a class="app-badge" href="https://www.ubereats.com/" target="_blank" rel="noopener" aria-label="Uber Eats">
          <svg viewBox="0 0 24 24" fill="none"><path d="M3 12h18" stroke="white" stroke-width="1.8" stroke-linecap="round"/><circle cx="7" cy="16" r="2" stroke="white" stroke-width="1.6"/><circle cx="17" cy="16" r="2" stroke="white" stroke-width="1.6"/></svg>
          Uber
        </a>
        <a class="app-badge" href="https://www.pyszne.pl/" target="_blank" rel="noopener" aria-label="Pyszne">
          <svg viewBox="0 0 24 24" fill="none"><path d="M4 20v-8l8-6 8 6v8" stroke="white" stroke-width="1.6" stroke-linejoin="round"/></svg>
          Pyszne
        </a>
        <a class="app-badge" href="https://bolt.eu/food/" target="_blank" rel="noopener" aria-label="Bolt Food">
          <svg viewBox="0 0 24 24" fill="none"><path d="M5 12h14M12 5v14" stroke="white" stroke-width="1.6" stroke-linecap="round"/></svg>
          Bolt
        </a>
      </div>
    </section>

    <!-- TABS -->
    <nav class="tabs">
      <div class="tabs-inner" id="tabs">
        <div class="tab active" onclick="switchTab('promo')">–ü—Ä–æ–º–æ–∞–∫—Ü–∏–∏</div>
        <div class="tab" onclick="switchTab('popular')">–°–∞–º–æ–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ</div>
        <div class="tab" onclick="switchTab('baked')">–ó–∞–ø–µ—á—ë–Ω–Ω—ã–µ —Ä–æ–ª–∏</div>
        <div class="tab" onclick="switchTab('sushirrito')">–°—É—à–∏—Ä–∏—Ç–æ</div>
        <div class="tab" onclick="switchTab('sets')">–°–µ—Ç—ã</div>
        <div class="tab" onclick="switchTab('soups')">–°—É–ø—ã</div>
        <div class="tab" onclick="switchTab('wok')">WOK ‚Ä¢ –õ–∞–ø—à–∞ ‚Ä¢ –†–∏—Å</div>
        <div class="tab" onclick="switchTab('salads')">–°–∞–ª–∞—Ç—ã</div>
        <div class="tab" onclick="switchTab('snacks')">–ó–∞–∫—É—Å–∫–∏</div>
      </div>
    </nav>

    <!-- CONTENT -->
    <section class="section" id="content">
      <div class="head">
        <h3 id="contentTitle">–ü—Ä–æ–º–æ–∞–∫—Ü–∏–∏</h3>
        <button class="view-toggle" id="viewToggle" data-view="grid" aria-label="–í–∏–¥ —Å–ø–∏—Å–∫–æ–º" title="–í–∏–¥ —Å–ø–∏—Å–∫–æ–º">
          <!-- –∏–∫–æ–Ω–∫–∞ "—Å–ø–∏—Å–æ–∫" -->
          <svg class="ico-list" viewBox="0 0 24 24" fill="none">
            <rect x="4" y="6"  width="16" height="2" rx="1" fill="white"/>
            <rect x="4" y="11" width="16" height="2" rx="1" fill="white"/>
            <rect x="4" y="16" width="16" height="2" rx="1" fill="white"/>
          </svg>
          <!-- –∏–∫–æ–Ω–∫–∞ "—Å–µ—Ç–∫–∞" -->
          <svg class="ico-grid" viewBox="0 0 24 24" fill="none">
            <rect x="4"  y="4"  width="7" height="7" rx="1" stroke="white" stroke-width="1.6"/>
            <rect x="13" y="4"  width="7" height="7" rx="1" stroke="white" stroke-width="1.6"/>
            <rect x="4"  y="13" width="7" height="7" rx="1" stroke="white" stroke-width="1.6"/>
            <rect x="13" y="13" width="7" height="7" rx="1" stroke="white" stroke-width="1.6"/>
          </svg>
        </button>
      </div>
      <div class="list" id="promoList"></div>
    </section>

    <!-- REST/GALLERY -->
    <section class="section" id="rest">
      <h3>–†–µ—Å—Ç–æ—Ä–∞–Ω ‚Ä¢ –ú–µ–Ω—é ‚Ä¢ –ì–∞–ª–µ—Ä–µ—è</h3>
      <p class="muted">–°–≤–µ–∂–∏–µ —Ä–æ–ª–ª—ã, —Å—É–ø—ã, –≤–æ–∫–∏ –∏ –¥–µ—Å–µ—Ä—Ç—ã. –°–º–æ—Ç—Ä–∏—Ç–µ –º–µ–Ω—é –∏ —Ñ–æ—Ç–æ –±–ª—é–¥.</p>
      <div class="cta-row">
        <a class="btn" href="menu.html">üçú –û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é</a>
        <a class="btn ghost" href="#gallery">üñº –ì–∞–ª–µ—Ä–µ—è</a>
      </div>
      <div class="gallery" id="gallery" style="margin-top:10px">
        <div class="ph"><img src="images/VORSPEISEN_SUPPEN_PHO_BO.png" alt="Pho"></div>
        <div class="ph"><img src="images/SUSHI_NIGIRI_AVOCADO.png" alt="Sushi"></div>
        <div class="ph"><img src="images/VORSPEISEN_SUPPEN_TOM_YAM.png" onerror="this.src='images/VORSPEISEN_SUPPEN_SUP_TOM_YAM.png'" alt="Wok"></div>
      </div>
    </section>

    <!-- CONTACT -->
    <section class="section" id="contact">
      <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
      <div class="list" style="grid-template-columns:1fr">
        <div class="card" style="grid-template-rows:auto auto">
          <div><b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> <a href="tel:+48600000000" style="color:#fff">+48 600 000 000</a></div>
          <div><b>E-mail:</b> <a href="mailto:hello@cyberdragon.rest" style="color:#fff">hello@cyberdragon.rest</a></div>
          <div><b>–ê–¥—Ä–µ—Å:</b> 54 Summit Street, Fremont</div>
          <div class="muted">–ü–Ω‚Äì–ß—Ç 11:00‚Äì22:00 ‚Ä¢ –ü—Ç‚Äì–°–± 11:00‚Äì23:00 ‚Ä¢ –í—Å 11:00‚Äì22:00</div>
        </div>
      </div>
    </section>

    <!-- MAP -->
    <section class="section" id="map">
      <h3>–ö–∞—Ä—Ç–∞</h3>
      <div class="map">
        <iframe src="https://www.google.com/maps?q=54%20Summit%20Street%20Fremont&output=embed" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade"></iframe>
      </div>
      <div class="cta-row" style="margin-top:10px">
        <a class="btn" target="_blank" rel="noopener" href="https://maps.google.com/?q=54+Summit+Street+Fremont">üìç –û—Ç–∫—Ä—ã—Ç—å –≤ Maps</a>
        <a class="btn ghost" href="#top">‚Üë –ù–∞–≤–µ—Ä—Ö</a>
      </div>
    </section>

    <!-- FAB CART -->
    <div class="fab">
      <button class="cart-fab" id="cartFab" aria-haspopup="dialog">üõí <span id="fabText">0 —à—Ç. ‚Ä¢ 0.00 ‚Ç¨</span></button>
    </div>
  </div>

  <!-- Bottom Sheet -->
  <div class="overlay" id="overlay"></div>
  <div class="sheet" id="sheet" role="dialog" aria-modal="true" aria-labelledby="sheetTitle">
    <button class="sheet-close" id="sheetClose" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>

    <h3 id="sheetTitle">–í–∞—à –∑–∞–∫–∞–∑</h3>
    <div class="cart-lines" id="cartLines"><div class="muted">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.</div></div>

    <div class="section">
      <div class="muted" id="orderTypeTitle" style="margin-bottom:6px">–¢–∏–ø –∑–∞–∫–∞–∑–∞</div>
      <div class="group" id="orderType">
        <button class="chip active" data-ot="on_site" id="otOnSite">–ù–∞ –º–µ—Å—Ç–µ</button>
        <button class="chip" data-ot="takeaway" id="otTakeaway">–ù–∞ –≤—ã–Ω–æ—Å</button>
        <button class="chip" data-ot="delivery" id="otDelivery">–î–æ—Å—Ç–∞–≤–∫–∞</button>
      </div>

      <div class="field" id="tableField" style="display:grid">
        <label for="tableNo" id="tableLbl">–°—Ç–æ–ª <span class="muted" id="tableHint">(–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></label>
        <input id="tableNo" type="number" min="1" inputmode="numeric" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 5">
      </div>

      <div class="field" id="takeawayField" style="display:none">
        <label for="pickupIn" id="pickupLbl">–ß–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –∑–∞–±—Ä–∞—Ç—å (–º–∏–Ω) <span class="muted" id="pickupHint">(–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></label>
        <input id="pickupIn" type="number" min="5" step="5" placeholder="15">
      </div>

      <div class="field" id="addrField" style="display:none">
        <label for="address" id="addrLbl">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ <span class="muted" id="addrHint">(–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></label>
        <textarea id="address" placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º, –ø–æ–¥—ä–µ–∑–¥..."></textarea>
      </div>

      <div class="field" id="phoneField">
        <label for="phone" id="phoneLbl">–¢–µ–ª–µ—Ñ–æ–Ω <span class="muted" id="phoneHint">(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></label>
        <input id="phone" type="tel" placeholder="+48 600 000 000">
      </div>
    </div>

    <div class="checkout">
      <div class="muted" id="cartMeta">–ò—Ç–æ–≥–æ: 0.00 ‚Ç¨</div>
      <button class="btn primary" id="checkoutBtn">–û—Ñ–æ—Ä–º–∏—Ç—å</button>
      <button class="btn ghost" id="clearBtn">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
  </div>

  <!-- DATA -->
  <script src="menu.js"></script>
  <script>
    if (typeof menuData !== 'undefined' && !window.menuData) { window.menuData = menuData; }
  </script>

  <script>
  /* ========= I18N ========= */
  const LANG_KEY='CD_LANG';
  let LANG = localStorage.getItem(LANG_KEY) || 'ru';
  document.documentElement.lang = LANG;

  const I18N = {
    ru:{navHome:'–ì–ª–∞–≤–Ω–∞—è',navMenu:'–ú–µ–Ω—é',navKaraoke:'–ö–∞—Ä–∞–æ–∫–µ',navContact:'–ö–æ–Ω—Ç–∞–∫—Ç—ã',btnMenu:'–ú–µ–Ω—é',
        tabs:{promo:'–ü—Ä–æ–º–æ–∞–∫—Ü–∏–∏',popular:'–°–∞–º–æ–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ',baked:'–ó–∞–ø–µ—á—ë–Ω–Ω—ã–µ —Ä–æ–ª–∏',sushirrito:'–°—É—à–∏—Ä–∏—Ç–æ',sets:'–°–µ—Ç—ã',soups:'–°—É–ø—ã',wok:'WOK ‚Ä¢ –õ–∞–ø—à–∞ ‚Ä¢ –†–∏—Å',salads:'–°–∞–ª–∞—Ç—ã',snacks:'–ó–∞–∫—É—Å–∫–∏'},
        viewList:'–í–∏–¥ —Å–ø–∏—Å–∫–æ–º',viewGrid:'–í–∏–¥ —Å–µ—Ç–∫–æ–π',
        ui:{add:'–î–æ–±–∞–≤–∏—Ç—å',more:'–ü–æ–¥—Ä–æ–±–Ω–µ–µ',itemsShort:'—à—Ç.'},
        common:{close:'–ó–∞–∫—Ä—ã—Ç—å', required:'(–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)', optional:'(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)'},
        sheet:{
          title:'–í–∞—à –∑–∞–∫–∞–∑', empty:'–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.', orderType:'–¢–∏–ø –∑–∞–∫–∞–∑–∞',
          onSite:'–ù–∞ –º–µ—Å—Ç–µ', takeaway:'–ù–∞ –≤—ã–Ω–æ—Å', delivery:'–î–æ—Å—Ç–∞–≤–∫–∞',
          table:'–°—Ç–æ–ª', pickupIn:'–ß–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –∑–∞–±—Ä–∞—Ç—å (–º–∏–Ω)', address:'–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏', phone:'–¢–µ–ª–µ—Ñ–æ–Ω',
          phTable:'–ù–∞–ø—Ä–∏–º–µ—Ä, 5', phPickup:'15', phAddress:'–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º, –ø–æ–¥—ä–µ–∑–¥...', phPhone:'+48 600 000 000',
          total:'–ò—Ç–æ–≥–æ', checkout:'–û—Ñ–æ—Ä–º–∏—Ç—å', clear:'–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É',
          errTable:'–£–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä —Å—Ç–æ–ª–∞.', errPickup:'–£–∫–∞–∂–∏—Ç–µ —á–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –∑–∞–±—Ä–∞—Ç—å.', errPhone:'–£–∫–∞–∂–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω.', errAddress:'–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏.'
        }},
    en:{navHome:'Home',navMenu:'Menu',navKaraoke:'Karaoke',navContact:'Contact',btnMenu:'Menu',
        tabs:{promo:'Promos',popular:'Most popular',baked:'Baked rolls',sushirrito:'Sushirrito',sets:'Sets',soups:'Soups',wok:'WOK ‚Ä¢ Noodles ‚Ä¢ Rice',salads:'Salads',snacks:'Snacks'},
        viewList:'List view',viewGrid:'Grid view',
        ui:{add:'Add',more:'More',itemsShort:'pcs'},
        common:{close:'Close', required:'(required)', optional:'(optional)'},
        sheet:{
          title:'Your order', empty:'Cart is empty.', orderType:'Order type',
          onSite:'Dine-in', takeaway:'Takeaway', delivery:'Delivery',
          table:'Table', pickupIn:'Pickup in (min)', address:'Delivery address', phone:'Phone',
          phTable:'e.g., 5', phPickup:'15', phAddress:'City, street, house‚Ä¶', phPhone:'+48 600 000 000',
          total:'Total', checkout:'Checkout', clear:'Clear cart',
          errTable:'Please enter table number.', errPickup:'Please enter pickup time (min).', errPhone:'Please enter phone.', errAddress:'Please enter delivery address.'
        }},
    ua:{navHome:'–ì–æ–ª–æ–≤–Ω–∞',navMenu:'–ú–µ–Ω—é',navKaraoke:'–ö–∞—Ä–∞–æ–∫–µ',navContact:'–ö–æ–Ω—Ç–∞–∫—Ç–∏',btnMenu:'–ú–µ–Ω—é',
        tabs:{promo:'–ü—Ä–æ–º–æ–∞–∫—Ü—ñ—ó',popular:'–ù–∞–π–ø–æ–ø—É–ª—è—Ä–Ω—ñ—à–µ',baked:'–ó–∞–ø–µ—á–µ–Ω—ñ —Ä–æ–ª–∏',sushirrito:'–°—É—à—ñ—Ä—ñ—Ç–æ',sets:'–ù–∞–±–æ—Ä–∏',soups:'–°—É–ø–∏',wok:'WOK ‚Ä¢ –õ–æ–∫—à–∏–Ω–∞ ‚Ä¢ –†–∏—Å',salads:'–°–∞–ª–∞—Ç–∏',snacks:'–ó–∞–∫—É—Å–∫–∏'},
        viewList:'–í–∏–≥–ª—è–¥ —Å–ø–∏—Å–∫–æ–º',viewGrid:'–í–∏–≥–ª—è–¥ —Å—ñ—Ç–∫–æ—é',
        ui:{add:'–î–æ–¥–∞—Ç–∏',more:'–î–æ–∫–ª–∞–¥–Ω—ñ—à–µ',itemsShort:'—à—Ç.'},
        common:{close:'–ó–∞–∫—Ä–∏—Ç–∏', required:'(–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)', optional:'(–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)'},
        sheet:{
          title:'–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è', empty:'–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π.', orderType:'–¢–∏–ø –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è',
          onSite:'–£ –∑–∞–∫–ª–∞–¥—ñ', takeaway:'–ù–∞ –≤–∏–Ω—ñ—Å', delivery:'–î–æ—Å—Ç–∞–≤–∫–∞',
          table:'–°—Ç—ñ–ª', pickupIn:'–ß–µ—Ä–µ–∑ —Å–∫—ñ–ª—å–∫–∏ –∑–∞–±—Ä–∞—Ç–∏ (—Ö–≤)', address:'–ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏', phone:'–¢–µ–ª–µ—Ñ–æ–Ω',
          phTable:'–ù–∞–ø—Ä–∏–∫–ª–∞–¥, 5', phPickup:'15', phAddress:'–ú—ñ—Å—Ç–æ, –≤—É–ª–∏—Ü—è, –±—É–¥–∏–Ω–æ–∫‚Ä¶', phPhone:'+48 600 000 000',
          total:'–†–∞–∑–æ–º', checkout:'–û—Ñ–æ—Ä–º–∏—Ç–∏', clear:'–û—á–∏—Å—Ç–∏—Ç–∏ –∫–æ—à–∏–∫',
          errTable:'–í–∫–∞–∂—ñ—Ç—å –Ω–æ–º–µ—Ä —Å—Ç–æ–ª—É.', errPickup:'–í–∫–∞–∂—ñ—Ç—å —á–∞—Å –æ—Ç—Ä–∏–º–∞–Ω–Ω—è (—Ö–≤).', errPhone:'–í–∫–∞–∂—ñ—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω.', errAddress:'–í–∫–∞–∂—ñ—Ç—å –∞–¥—Ä–µ—Å—É –¥–æ—Å—Ç–∞–≤–∫–∏.'
        }},
    pl:{navHome:'Start',navMenu:'Menu',navKaraoke:'Karaoke',navContact:'Kontakt',btnMenu:'Menu',
        tabs:{promo:'Promocje',popular:'Najpopularniejsze',baked:'Rolki zapiekane',sushirrito:'Sushirrito',sets:'Zestawy',soups:'Zupy',wok:'WOK ‚Ä¢ Makaron ‚Ä¢ Ry≈º',salads:'Sa≈Çatki',snacks:'Przystawki'},
        viewList:'Widok listy',viewGrid:'Widok siatki',
        ui:{add:'Dodaj',more:'Szczeg√≥≈Çy',itemsShort:'szt.'},
        common:{close:'Zamknij', required:'(wymagane)', optional:'(opcjonalnie)'},
        sheet:{
          title:'Twoje zam√≥wienie', empty:'Koszyk jest pusty.', orderType:'Typ zam√≥wienia',
          onSite:'Na miejscu', takeaway:'Na wynos', delivery:'Dostawa',
          table:'St√≥≈Ç', pickupIn:'Odbi√≥r za (min)', address:'Adres dostawy', phone:'Telefon',
          phTable:'Np. 5', phPickup:'15', phAddress:'Miasto, ulica, nr domu‚Ä¶', phPhone:'+48 600 000 000',
          total:'Suma', checkout:'Zam√≥w', clear:'Wyczy≈õƒá koszyk',
          errTable:'Podaj numer sto≈Çu.', errPickup:'Podaj czas odbioru (min).', errPhone:'Podaj telefon.', errAddress:'Podaj adres dostawy.'
        }},
    de:{navHome:'Start',navMenu:'Men√º',navKaraoke:'Karaoke',navContact:'Kontakt',btnMenu:'Men√º',
        tabs:{promo:'Aktionen',popular:'Am beliebtesten',baked:'Gebackene Rollen',sushirrito:'Sushirrito',sets:'Sets',soups:'Suppen',wok:'WOK ‚Ä¢ Nudeln ‚Ä¢ Reis',salads:'Salate',snacks:'Vorspeisen'},
        viewList:'Listenansicht',viewGrid:'Rasteransicht',
        ui:{add:'Hinzuf√ºgen',more:'Details',itemsShort:'St.'},
        common:{close:'Schlie√üen', required:'(erforderlich)', optional:'(optional)'},
        sheet:{
          title:'Ihre Bestellung', empty:'Warenkorb ist leer.', orderType:'Bestellart',
          onSite:'Vor Ort', takeaway:'Zum Mitnehmen', delivery:'Lieferung',
          table:'Tisch', pickupIn:'Abholung in (Min.)', address:'Lieferadresse', phone:'Telefon',
          phTable:'z. B. 5', phPickup:'15', phAddress:'Stadt, Stra√üe, Nr.‚Ä¶', phPhone:'+48 600 000 000',
          total:'Gesamt', checkout:'Bestellen', clear:'Warenkorb leeren',
          errTable:'Bitte Tisch-Nr. eingeben.', errPickup:'Bitte Abholzeit (Min.) eingeben.', errPhone:'Bitte Telefon eingeben.', errAddress:'Bitte Lieferadresse eingeben.'
        }},
    zh:{navHome:'‰∏ªÈ°µ',navMenu:'ËèúÂçï',navKaraoke:'Âç°ÊãâOK',navContact:'ËÅîÁ≥ª',btnMenu:'ËèúÂçï',
        tabs:{promo:'‰øÉÈîÄ',popular:'ÊúÄÂèóÊ¨¢Ëøé',baked:'ÁÉ§Âç∑',sushirrito:'ÂØøÂè∏Âç∑È•º',sets:'Â•óÈ§ê',soups:'Ê±§ÂìÅ',wok:'WOK ‚Ä¢ Èù¢ ‚Ä¢ Á±≥È•≠',salads:'Ê≤ôÊãâ',snacks:'Â∞èÂêÉ'},
        viewList:'ÂàóË°®ËßÜÂõæ',viewGrid:'ÁΩëÊ†ºËßÜÂõæ',
        ui:{add:'Ê∑ªÂä†',more:'ËØ¶ÊÉÖ',itemsShort:'‰ª∂'},
        common:{close:'ÂÖ≥Èó≠', required:'(ÂøÖÂ°´)', optional:'(ÂèØÈÄâ)'},
        sheet:{
          title:'ÊÇ®ÁöÑËÆ¢Âçï', empty:'Ë¥≠Áâ©ËΩ¶‰∏∫Á©∫„ÄÇ', orderType:'ËÆ¢ÂçïÁ±ªÂûã',
          onSite:'Â†ÇÈ£ü', takeaway:'Â§ñÂ∏¶', delivery:'ÈÖçÈÄÅ',
          table:'Ê°åÂè∑', pickupIn:'ÂèñÈ§êÊó∂Èó¥ÔºàÂàÜÈíüÔºâ', address:'ÈÖçÈÄÅÂú∞ÂùÄ', phone:'ÁîµËØù',
          phTable:'‰æãÂ¶Ç 5', phPickup:'15', phAddress:'ÂüéÂ∏Ç„ÄÅË°óÈÅì„ÄÅÈó®Áâå‚Ä¶', phPhone:'+48 600 000 000',
          total:'ÂêàËÆ°', checkout:'‰∏ãÂçï', clear:'Ê∏ÖÁ©∫Ë¥≠Áâ©ËΩ¶',
          errTable:'ËØ∑ËæìÂÖ•Ê°åÂè∑„ÄÇ', errPickup:'ËØ∑ËæìÂÖ•ÂèñÈ§êÊó∂Èó¥ÔºàÂàÜÈíüÔºâ„ÄÇ', errPhone:'ËØ∑ËæìÂÖ•ÁîµËØù„ÄÇ', errAddress:'ËØ∑ËæìÂÖ•ÈÖçÈÄÅÂú∞ÂùÄ„ÄÇ'
        }},
    vn:{navHome:'Trang ch·ªß',navMenu:'Th·ª±c ƒë∆°n',navKaraoke:'Karaoke',navContact:'Li√™n h·ªá',btnMenu:'Th·ª±c ƒë∆°n',
        tabs:{promo:'Khuy·∫øn m√£i',popular:'Ph·ªï bi·∫øn nh·∫•t',baked:'Cu·ªôn n∆∞·ªõng',sushirrito:'Sushirrito',sets:'Set',soups:'S√∫p',wok:'WOK ‚Ä¢ M√¨ ‚Ä¢ C∆°m',salads:'Salad',snacks:'M√≥n ƒÉn nh·∫π'},
        viewList:'D·∫°ng danh s√°ch',viewGrid:'D·∫°ng l∆∞·ªõi',
        ui:{add:'Th√™m',more:'Chi ti·∫øt',itemsShort:'m√≥n'},
        common:{close:'ƒê√≥ng', required:'(b·∫Øt bu·ªôc)', optional:'(kh√¥ng b·∫Øt bu·ªôc)'},
        sheet:{
          title:'ƒê∆°n h√†ng c·ªßa b·∫°n', empty:'Gi·ªè h√†ng tr·ªëng.', orderType:'H√¨nh th·ª©c ƒë·∫∑t',
          onSite:'ƒÇn t·∫°i ch·ªó', takeaway:'Mang ƒëi', delivery:'Giao h√†ng',
          table:'B√†n', pickupIn:'Nh·∫≠n sau (ph√∫t)', address:'ƒê·ªãa ch·ªâ giao h√†ng', phone:'ƒêi·ªán tho·∫°i',
          phTable:'V√≠ d·ª•: 5', phPickup:'15', phAddress:'Th√†nh ph·ªë, ƒë∆∞·ªùng, s·ªë nh√†‚Ä¶', phPhone:'+48 600 000 000',
          total:'T·ªïng c·ªông', checkout:'ƒê·∫∑t h√†ng', clear:'X√≥a gi·ªè h√†ng',
          errTable:'Vui l√≤ng nh·∫≠p s·ªë b√†n.', errPickup:'Vui l√≤ng nh·∫≠p th·ªùi gian nh·∫≠n (ph√∫t).', errPhone:'Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i.', errAddress:'Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ giao h√†ng.'
        }}
  };
  const L = () => I18N[LANG] || I18N.en;
  </script>

  <script>
  /* ===== Helpers & state ===== */
  const $  = s => document.querySelector(s);
  const $$ = s => document.querySelectorAll(s);
  const CURRENCY='‚Ç¨';
  const IMG_DIR='images/'; const IMG_EXTS=['webp','jpg','jpeg','png'];

  function buildThumb(imgEl, key){
    let i=0; const trySet=()=>imgEl.src=IMG_DIR + key + '.' + IMG_EXTS[i];
    imgEl.onerror=()=>{ i++; if(i<IMG_EXTS.length){ trySet(); } else { imgEl.closest('.thumb')?.classList.add('noimg'); imgEl.remove(); } };
    trySet();
  }
  function itemName(it){
    return (it?.translations?.[LANG]) || it?.translations?.en || (it?.key||'').replaceAll('_',' ');
  }

  /* ===== Telegram (optional) ===== */
  const TG = { BOT_TOKEN:"6819820426:AAEWwwN8tYLVPo6U-g6EjWCo4evnJ2SaGk4", CHAT_ID:-1002156259709, PROXY_URL:"" };
  const TG_ENDPOINT = (b)=> (TG.PROXY_URL || "https://api.telegram.org/bot"+b+"/sendMessage");

  /* ===== Burger ===== */
  const burger = $('#burger'), navPop = $('#navPop');
  burger.addEventListener('click', ()=>{ const open=navPop.classList.toggle('open'); burger.setAttribute('aria-expanded', String(open)); });
  document.addEventListener('click', e=>{ if(!navPop.contains(e.target) && e.target!==burger){ navPop.classList.remove('open'); burger.setAttribute('aria-expanded','false'); } });

  /* ===== Cart ===== */
  const cart = new Map();
  function getItemById(id){
    const [cat,idx] = id.split(':'); const arr = (window.menuData||{})[cat]||[];
    return arr[+idx];
  }
  function renderFab(){
    let items=0,sum=0;
    for(const [id,qty] of cart){ const it=getItemById(id); if(!it) continue; items+=qty; sum+=(Number(it.price||0)*qty); }
    $('#fabText').textContent = `${items} ${L().ui.itemsShort} ‚Ä¢ ${sum.toFixed(2)} ${CURRENCY}`;
  }
  function renderCartSheet(){
    const lines = $('#cartLines');
    const t = L().sheet;
    if(cart.size===0){
      lines.innerHTML = `<div class="muted">${t.empty}</div>`;
      $('#cartMeta').textContent = `${t.total}: 0.00 ${CURRENCY}`;
      return;
    }
    let sum=0; lines.innerHTML='';
    for(const [id,qty] of cart){
      const it=getItemById(id); if(!it) continue;
      const name=itemName(it); const price=Number(it.price||0); sum+=price*qty;
      const el=document.createElement('div'); el.className='line';
      el.innerHTML='<div><strong>'+name+'</strong><div class="muted">'+price.toFixed(2)+' '+CURRENCY+' √ó '+qty+'</div></div>'+
        '<div class="qty" data-qty="'+id+'"><button data-dec="'+id+'">‚àí</button><span>'+qty+'</span><button data-inc="'+id+'">+</button></div>';
      lines.appendChild(el);
    }
    $('#cartMeta').textContent = `${t.total}: ${sum.toFixed(2)} ${CURRENCY}`;
  }
  function openSheet(){ document.body.style.overflow='hidden'; $('#overlay').classList.add('show'); $('#sheet').classList.add('open'); renderCartSheet(); }
  function closeSheet(){ document.body.style.overflow=''; $('#overlay').classList.remove('show'); $('#sheet').classList.remove('open'); }
  $('#sheetClose')?.addEventListener('click', closeSheet);

  window.add = function(id){
    if(!getItemById(id)){ console.warn('–ù–µ—Ç –ø–æ–∑–∏—Ü–∏–∏', id); return; }
    cart.set(id, (cart.get(id)||0)+1);
    renderFab();
  };

  document.addEventListener('click', e=>{
    if(e.target.closest('#cartFab')){ openSheet(); return; }
    if(e.target.id==='overlay'){ closeSheet(); return; }
    const inc=e.target.closest('[data-inc]'); if(inc){ const id=inc.dataset.inc; cart.set(id,(cart.get(id)||0)+1); renderCartSheet(); renderFab(); return; }
    const dec=e.target.closest('[data-dec]'); if(dec){ const id=dec.dataset.dec; const q=(cart.get(id)||0)-1; if(q<=0) cart.delete(id); else cart.set(id,q); renderCartSheet(); renderFab(); return; }
    if(e.target.id==='clearBtn'){ cart.clear(); renderCartSheet(); renderFab(); return; }
  });

  /* ===== Order type ===== */
  const otWrap=$('#orderType'),
        tableField=$('#tableField'), takeawayField=$('#takeawayField'), addrField=$('#addrField');
  const tableNo=$('#tableNo'), pickupIn=$('#pickupIn'), address=$('#address'), phone=$('#phone'), phoneHint=$('#phoneHint');
  function show(el,on){ if(!el) return; el.style.display=on?'grid':'none'; }
  function setOrderType(v){
    show(tableField, v==='on_site'); show(takeawayField, v==='takeaway'); show(addrField, v==='delivery');
    if(tableNo) tableNo.required=(v==='on_site');
    if(pickupIn) pickupIn.required=(v==='takeaway');
    if(address) address.required=(v==='delivery');
    if(phoneHint) phoneHint.textContent = (v!=='on_site') ? L().common.required : L().common.optional;
  }
  if(otWrap){
    otWrap.addEventListener('click',e=>{
      const b=e.target.closest('[data-ot]'); if(!b) return;
      $$('#orderType .chip').forEach(x=>x.classList.remove('active'));
      b.classList.add('active'); setOrderType(b.dataset.ot);
    });
    setOrderType('on_site');
  }

  /* ===== Telegram send (optional) ===== */
  async function sendOrderToTelegram(text){
    const url = TG_ENDPOINT(TG.BOT_TOKEN);
    const payload = {chat_id: TG.CHAT_ID, text: text, parse_mode: "HTML", disable_web_page_preview: true};
    try{
      const r = await fetch(url, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
      if(r.ok) return {ok:true};
      await fetch(url, {method:'POST', mode:'no-cors', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
      return {ok:true, opaque:true};
    }catch(e){ console.error(e); return {ok:false, reason:String(e)}; }
  }
  function cartSummary(){
    let items=0,sum=0, lines=[];
    for(const [id,qty] of cart){
      const it=getItemById(id); if(!it) continue;
      const name=itemName(it); const price=Number(it.price||0);
      items+=qty; sum+=price*qty;
      lines.push('‚Ä¢ '+name+' ‚Äî '+price.toFixed(2)+' '+CURRENCY+' √ó '+qty);
    }
    return {items,sum,lines};
  }
  $('#checkoutBtn')?.addEventListener('click', async ()=>{
    const t = L().sheet;
    const ot=document.querySelector('#orderType .chip.active')?.dataset.ot||'on_site';
    if(ot==='on_site' && !tableNo.value.trim()){ alert(t.errTable); return; }
    if(ot==='takeaway'){
      if(!pickupIn.value.trim()){ alert(t.errPickup); return; }
      if(!phone.value.trim()){ alert(t.errPhone); return; }
    }
    if(ot==='delivery'){
      if(!address.value.trim()){ alert(t.errAddress); return; }
      if(!phone.value.trim()){ alert(t.errPhone); return; }
    }
    const s=cartSummary();
    const typeStr = ot==='on_site' ? t.onSite : (ot==='takeaway' ? t.takeaway : t.delivery);
    const meta=[];
    if(ot==='on_site') meta.push(`${t.table}: ${tableNo.value.trim()}`);
    if(ot==='takeaway') meta.push(`${t.pickupIn}: ${pickupIn.value.trim()}`);
    if(ot==='delivery') meta.push(`${t.address}: ${address.value.trim()}`);
    if(phone?.value.trim()) meta.push(`${t.phone}: ${phone.value.trim()}`);
    const ordId = 'CD-' + new Date().toISOString().replace(/[-:TZ.]/g,'').slice(0,14);

    const text =
      '<b>CYBER DRAGON</b>\n' +
      'ID: <code>'+ordId+'</code>\n' +
      t.total+': <b>'+s.sum.toFixed(2)+' '+CURRENCY+'</b>\n' +
      '–¢–∏–ø: <b>'+typeStr+'</b>\n' +
      (meta.length?meta.join('\n')+'\n\n':'\n') +
      '<b>Items:</b>\n' +
      (s.lines.join('\n') || '‚Äî');

    const res = await sendOrderToTelegram(text);
    alert((res.ok ? '‚úî' : '‚Ä¶') + ' ID: ' + ordId + ' ‚Ä¢ ' + t.total + ': ' + s.sum.toFixed(2) + ' ' + CURRENCY);

    cart.clear(); renderCartSheet(); renderFab(); closeSheet();
  });

  /* ===== Collectors & renderer for tabs ===== */
  function collectPromo(limit=6){
    const d = window.menuData||{};
    const order = ['SUSHI','VORSPEISEN','HAUPTSPEISEN','GETR√ÑNKE','NACHSPEISEN','BEILAGEN'];
    const out=[];
    for(const cat of order){
      const arr=d[cat]||[];
      for(let i=0;i<arr.length && out.length<limit;i++) out.push({id:cat+':'+i,item:arr[i]});
      if(out.length>=limit) break;
    }
    if(out.length<limit){
      for(const cat of Object.keys(d)){
        const arr=d[cat]||[];
        for(let i=0;i<arr.length && out.length<limit;i++){
          const id=cat+':'+i; if(out.find(x=>x.id===id)) continue;
          out.push({id:id,item:arr[i]});
        }
        if(out.length>=limit) break;
      }
    }
    return out;
  }
  function collectPopular(limit=12){
    const d = window.menuData||{}; const out=[]; const cats=Object.keys(d).sort();
    for(const cat of cats){
      const arr=d[cat]||[];
      for(let i=arr.length-1;i>=0 && out.length<limit;i--) out.push({id:cat+':'+i,item:arr[i]});
      if(out.length>=limit) break;
    }
    return out;
  }
  function collectBaked(limit=12){
    const d = window.menuData||{}; const out=[]; const kw=['–∑–∞–ø–µ—á','baked','yaki','—è–∫–∏'];
    for(const cat of Object.keys(d)){
      const arr=d[cat]||[];
      for(let i=0;i<arr.length;i++){
        const it=arr[i]; const txt=((it.key||'')+' '+(it.desc||'')+' '+(it.translations?.ru||'')).toLowerCase();
        if(kw.some(k=>txt.includes(k))) out.push({id:cat+':'+i,item:it});
        if(out.length>=limit) return out;
      }
    }
    return out.length?out:collectPromo(limit);
  }
  function renderListBy(list){
    const wrap = $('#promoList');
    const ui = L().ui;
    wrap.innerHTML = list.map(({id,item})=>{
      const name = itemName(item);
      const price = (Number(item.price||0)).toFixed(2)+' '+CURRENCY;
      return (
        '<div class="card" data-id="'+id+'">'+
          '<div class="thumb-wrap">'+
            '<div class="thumb"><img alt="'+name+'" loading="lazy" decoding="async"></div>'+
            '<button class="info" data-toggle="'+id+'" title="'+ui.more+'">i</button>'+
          '</div>'+
          '<div class="name">'+name+'</div>'+
          '<div class="foot"><div class="price">'+price+'</div>'+
            '<button class="add" onclick="add(\''+id+'\')">'+ui.add+'</button>'+
          '</div>'+
        '</div>'
      );
    }).join('');

    wrap.querySelectorAll('.card').forEach(row=>{
      const id=row.getAttribute('data-id'); const [cat,idx]=id.split(':');
      const key=(window.menuData?.[cat]?.[+idx]?.key)||'';
      const img=row.querySelector('.thumb img');
      if(img && key) buildThumb(img,key);
    });

    applyView();
  }

  /* ===== Tabs + View toggle ===== */
  function switchTab(k){
    $$('#tabs .tab').forEach(t=>{ t.classList.toggle('active', t.getAttribute('onclick').includes("'" + k + "'")); });
    const titles = L().tabs;
    $('#contentTitle').textContent = titles[k] || titles.promo;

    if(k==='promo') renderListBy(collectPromo());
    else if(k==='popular') renderListBy(collectPopular());
    else if(k==='baked') renderListBy(collectBaked());
    else renderListBy(collectPromo()); // –≤—Ä–µ–º–µ–Ω–Ω–æ
  }
  window.switchTab = switchTab;

  // –í–∏–¥: —Å–µ—Ç–∫–∞ / —Å–ø–∏—Å–æ–∫
  const VIEW_KEY='CD_VIEW';
  let viewMode = localStorage.getItem(VIEW_KEY) || 'grid';
  function applyView(){
    const wrap = document.getElementById('promoList');
    const btn  = document.getElementById('viewToggle');
    if(!wrap || !btn) return;
    wrap.classList.toggle('as-list', viewMode==='list');
    btn.dataset.view = viewMode;
    const to = (viewMode==='grid') ? L().viewList : L().viewGrid;
    btn.setAttribute('aria-label', to);
    btn.title = to;
  }
  document.getElementById('viewToggle')?.addEventListener('click', ()=>{
    viewMode = (viewMode==='grid') ? 'list' : 'grid';
    localStorage.setItem(VIEW_KEY, viewMode);
    applyView();
  });

  document.addEventListener('click', e=>{
    const info = e.target.closest('[data-toggle]');
    if(info){
      const card = document.querySelector('.card[data-id="'+info.dataset.toggle+'"]');
      if(card) card.classList.toggle('expanded');
    }
  });

  /* ===== UI text setters ===== */
  let currentTab = 'promo';
  const originalSwitchTab = window.switchTab;
  window.switchTab = function(k){ currentTab = k; originalSwitchTab(k); setTitles(); };

  function setSheetTexts(){
    const t = L(), s=t.sheet;
    $('#sheetTitle').textContent      = s.title;
    $('#orderTypeTitle').textContent  = s.orderType;
    $('#otOnSite').textContent        = s.onSite;
    $('#otTakeaway').textContent      = s.takeaway;
    $('#otDelivery').textContent      = s.delivery;

    if($('#tableLbl'))  $('#tableLbl').childNodes[0].nodeValue  = s.table+' ';
    if($('#pickupLbl')) $('#pickupLbl').childNodes[0].nodeValue = s.pickupIn+' ';
    if($('#addrLbl'))   $('#addrLbl').childNodes[0].nodeValue   = s.address+' ';
    if($('#phoneLbl'))  $('#phoneLbl').childNodes[0].nodeValue  = s.phone+' ';

    $('#tableHint').textContent  = t.common.required;
    $('#pickupHint').textContent = t.common.required;
    $('#addrHint').textContent   = t.common.required;

    $('#tableNo').placeholder = s.phTable;
    $('#pickupIn').placeholder = s.phPickup;
    $('#address').placeholder  = s.phAddress;
    $('#phone').placeholder    = s.phPhone;

    // bottom
    const meta = $('#cartMeta');
    if(meta){
      const sum = (meta.textContent.match(/[\d.,]+\s*‚Ç¨/) || ['0.00 ‚Ç¨'])[0];
      meta.textContent = `${s.total}: ${sum}`;
    }
    $('#checkoutBtn').textContent = s.checkout;
    $('#clearBtn').textContent    = s.clear;

    // close
    $('#sheetClose')?.setAttribute('aria-label', t.common.close);
  }

  function setTitles(){
    const t = L();
    const set = (sel, txt) => { const n=$(sel); if(n) n.textContent = txt; };
    set('#navHome',     'üè† ' + t.navHome);
    set('#navMenu',     'üçú ' + t.navMenu);
    set('#navKaraoke',  'üé§ ' + t.navKaraoke);
    set('#navContact',  'üìû ' + t.navContact);
    set('#btnMenu',     'üçú ' + t.btnMenu);

    const map = t.tabs;
    const setTab = key => {
      const el = document.querySelector(`[onclick="switchTab('${key}')"]`);
      if(el) el.textContent = map[key] || I18N.en.tabs[key];
    };
    ['promo','popular','baked','sushirrito','sets','soups','wok','salads','snacks'].forEach(setTab);

    $('#contentTitle').textContent = map[currentTab] || map.promo;

    // –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–ª—è –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –∏ –∫–Ω–æ–ø–æ–∫
    if(currentTab==='promo')       renderListBy(collectPromo());
    else if(currentTab==='popular')renderListBy(collectPopular());
    else if(currentTab==='baked')  renderListBy(collectBaked());

    applyView();
    setSheetTexts();
    renderFab();
    renderCartSheet();
  }

  /* ===== Language selectors ===== */
  const selA = $('#langSel'), selB = $('#langSelMenu');
  function setLang(v){
    LANG = v; localStorage.setItem(LANG_KEY, v);
    document.documentElement.lang = v;
    if(selA) selA.value = v;
    if(selB) selB.value = v;
    setTitles();
  }
  if(selA){ selA.value = LANG; selA.addEventListener('change', e=>setLang(e.target.value)); }
  if(selB){ selB.value = LANG; selB.addEventListener('change', e=>setLang(e.target.value)); }

  /* ===== Init ===== */
  setTitles();
  switchTab('promo');
  applyView();
  </script>
</body>
</html>
